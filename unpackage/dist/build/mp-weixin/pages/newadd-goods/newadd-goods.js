(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/newadd-goods/newadd-goods"],{"7a37":function(t,e,i){"use strict";var n={"uni-combox":function(){return i.e("components/uni-combox/uni-combox").then(i.bind(null,"cd15"))}},o=function(){var t=this,e=t.$createElement;t._self._c},s=[];i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return s})),i.d(e,"a",(function(){return n}))},"90b2":function(t,e,i){"use strict";(function(t){i("2e69"),i("921b");n(i("66fd"));var e=n(i("b031"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},b031:function(t,e,i){"use strict";i.r(e);var n=i("7a37"),o=i("b6d7");for(var s in o)"default"!==s&&function(t){i.d(e,t,(function(){return o[t]}))}(s);var a,u=i("f0c5"),c=Object(u["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);e["default"]=c.exports},b4cf:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i("2f62");function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,n)}return i}function s(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var u=function(){i.e("components/popup/specification-popup").then(function(){return resolve(i("d315"))}.bind(null,i)).catch(i.oe)},c=function(){i.e("components/popup/taste-popup").then(function(){return resolve(i("a2b2"))}.bind(null,i)).catch(i.oe)},r=function(){i.e("components/uni-combox/uni-combox").then(function(){return resolve(i("cd15"))}.bind(null,i)).catch(i.oe)},p={components:{specificationPopup:u,tastePopup:c,uniCombox:r},data:function(){return{picUrl:null,tempPicList:null,productDesText:null,numberText:null,SpecificationList:null,TasteList:null,sortValueText:0,priceText:null,nameText:null,typeText:null,Enabled:1,IsLimitBuy:0,Stock:0,ID:null,title:"新增产品信息",tasteTitle:"添加产品口味",specTitle:"添加产品规格",btnName:"提交新增",isChange:!1}},onLoad:function(t){t.ID&&(this.getItem(t.ID),this.ID=t.ID,this.isChange=!0,this.title="修改产品信息",this.tasteTitle="修改产品口味",this.specTitle="修改产品规格",this.btnName="确认修改")},computed:s({},(0,n.mapState)({goodsTypeList:function(t){return t.goods.goodsTypeList},goodsList:function(t){return t.goods.goodsList}}),{},(0,n.mapGetters)([]),{isShowStock:function(){return 1==this.IsLimitBuy||0!=this.IsLimitBuy&&void 0},getTypeNameList:function(){for(var t=[],e=0;e<this.goodsTypeList.length;e++)t.push(this.goodsTypeList[e].Name);return t},getTypeName:function(){if(!this.typeText)return"";for(var t=0;t<this.goodsTypeList.length;t++)if(this.goodsTypeList[t].ID==this.typeText)return this.goodsTypeList[t].Name}}),methods:s({},(0,n.mapMutations)(["updateGoodsTypeList","pushUpdateGoodsTypeList","updateGoodsList"]),{},(0,n.mapActions)(["updateGoodsListFunc"]),{getItem:function(t){for(var e=0;e<this.goodsList.length;e++)if(this.goodsList[e].ID==t)return void this.syncItemData(this.goodsList[e])},syncItemData:function(t){this.picUrl=t.TitleImgUrl,this.productDesText=t.Description,this.numberText=t.Code,this.SpecificationList=t.SpecificationList,this.TasteList=t.TasteList,this.sortValueText=t.SortValue,this.priceText=t.Price,this.nameText=t.Name,this.typeText=t.ProductTypeID,this.Enabled=t.Enabled,this.IsLimitBuy=t.IsLimitBuy,this.Stock=t.Stock},upload:function(){var e=this;t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(t){t.tempFilePaths,e.urlTobase64(t.tempFilePaths[0],e.uploadPic)},error:function(t){console.log(t)}})},uploadPic:function(e){var i=this;t.showLoading({title:"上传图片中..."}),i.$H.post("/api/Product/UploadImg",{ImgBase64:e},{token:!0}).then((function(n){console.log(n),t.hideLoading(),0===n.status?(i.picUrl=e,i.tempPicList=n.data):t.showToast({title:n.message,icon:"none",duration:1e3})}))},urlTobase64:function(e,i){t.request({url:e,method:"GET",responseType:"arraybuffer",success:function(t){var e=wx.arrayBufferToBase64(t.data);e="data:image/jpeg;base64,"+e,i(e)}})},productDesInput:function(t){this.productDesText=t.detail.value},sortValueInput:function(t){this.sortValueText=t.detail.value},numberInput:function(t){this.numberText=t.detail.value},priceInput:function(t){this.priceText=t.detail.value},nameInput:function(t){this.nameText=t.detail.value},typeInput:function(t){for(var e=0;e<this.goodsTypeList.length;e++){var i=this.goodsTypeList[e];if(i.Name==t)return this.typeText=i.ID,void console.log(this.typeText)}this.typeText=null},stockInput:function(t){this.Stock=t.detail.value},syncSpecInput:function(t){this.SpecificationList=t},syncTasteInput:function(t){this.TasteList=t},checkboxIsLimitBuy:function(t){var e=t.target.value;this.IsLimitBuy="shi"==e?1:0},checkboxEnabled:function(t){var e=t.target.value;this.Enabled="shi"==e?1:0},addGoodsTaste:function(){this.$refs.tastePopup.showPopup(this.TasteList,this.syncTasteInput)},addGoodsSpec:function(){this.$refs.specPopup.showPopup(this.SpecificationList,this.syncSpecInput)},uploadInfo:function(){var e=this,i="";if(e.typeText||(i="请选择产品类别"),e.nameText||(i="请输入产品名称"),e.priceText||(i="请输入产品价格"),e.tempPicList||this.isChange||(i="请上传产品图片"),1==e.IsLimitBuy&&e.Stock<=0&&(i="请输入正确的库存"),i)t.showToast({title:i,icon:"none",duration:1e3});else{var n={ProductTypeID:e.typeText,Name:e.nameText,Price:e.priceText,SortValue:e.sortValueText,Enabled:e.Enabled,Stock:e.Stock,IsLimitBuy:e.IsLimitBuy};e.tempPicList?(n.TempImgPath=e.tempPicList.TempImgPath,n.TitleImgUrl=e.tempPicList.TitleImgUrl):(n.TitleImgUrl=e.picUrl,n.TempImgPath=""),e.productDesText&&(n.Description=e.productDesText),e.numberText&&(n.Code=e.numberText),e.SpecificationList&&(n.SpecificationList=e.SpecificationList),e.TasteList&&(n.TasteList=e.TasteList),e.ID&&(n.ID=e.ID),t.showLoading({title:"上传信息中..."});var o="/api/Product/Add";e.isChange&&(o="/api/Product/Update"),console.log(JSON.stringify(n)),e.$H.post(o,{data:JSON.stringify(n)},{token:!0}).then((function(i){if(console.log(i),t.hideLoading(),0===i.status){var n=e.goodsList;if(e.isChange){for(var o=0;o<n.length;o++)if(n[o].ID==i.data.ID){n.splice(o,1,i.data);break}}else n.unshift(i.data);t.navigateBack({delta:1})}else t.showToast({title:i.message,icon:"none",duration:1e3})}))}}})};e.default=p}).call(this,i("543d")["default"])},b6d7:function(t,e,i){"use strict";i.r(e);var n=i("b4cf"),o=i.n(n);for(var s in n)"default"!==s&&function(t){i.d(e,t,(function(){return n[t]}))}(s);e["default"]=o.a}},[["90b2","common/runtime","common/vendor"]]]);